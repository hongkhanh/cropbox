"use strict";!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){jQuery.fn.cropbox=function(e){return new function(e,n){var i={state:{},ratio:1,options:e,imageBox:n=n||t(e.imageBox),thumbBox:n.find(e.thumbBox),spinner:n.find(e.spinner),image:new Image,getDataURL:function(){var t=this.thumbBox.width(),e=this.thumbBox.height(),i=document.createElement("canvas"),a=n.css("background-position").split(" "),o=n.css("background-size").split(" "),s=parseInt(a[0])-n.width()/2+t/2,r=parseInt(a[1])-n.height()/2+e/2,u=parseInt(o[0]),c=parseInt(o[1]),g=parseInt(this.image.height),d=parseInt(this.image.width);return i.width=t,i.height=e,i.getContext("2d").drawImage(this.image,0,0,d,g,s,r,u,c),i.toDataURL("image/png")},getBlob:function(){for(var t=this.getDataURL().replace("data:image/png;base64,",""),e=atob(t),n=[],i=0;i<e.length;i++)n.push(e.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:"image/png"})},zoomIn:function(){this.ratio*=1.1,a()},zoomOut:function(){this.ratio*=.9,a()}},a=function(){var t=parseInt(i.image.width)*i.ratio,e=parseInt(i.image.height)*i.ratio,a=(n.width()-t)/2,o=(n.height()-e)/2;n.css({"background-image":"url("+i.image.src+")","background-size":t+"px "+e+"px","background-position":a+"px "+o+"px","background-repeat":"no-repeat"})},o=function(t){t.stopImmediatePropagation(),i.state.dragable=!0,i.state.mouseX=t.clientX,i.state.mouseY=t.clientY},s=function(t){t.stopImmediatePropagation(),i.state.dragable=!0,i.state.mouseX=t.changedTouches[0].clientX,i.state.mouseY=t.changedTouches[0].clientY},r=function(t){if(t.stopImmediatePropagation(),i.state.dragable){var e=t.clientX-i.state.mouseX,a=t.clientY-i.state.mouseY,o=n.css("background-position").split(" "),s=e+parseInt(o[0]),r=a+parseInt(o[1]);n.css("background-position",s+"px "+r+"px"),i.state.mouseX=t.clientX,i.state.mouseY=t.clientY}},u=function(t){if(t.stopImmediatePropagation(),i.state.dragable){var e=t.changedTouches[0].clientX-i.state.mouseX,a=t.changedTouches[0].clientY-i.state.mouseY,o=n.css("background-position").split(" "),s=e+parseInt(o[0]),r=a+parseInt(o[1]);n.css("background-position",s+"px "+r+"px"),i.state.mouseX=t.changedTouches[0].clientX,i.state.mouseY=t.changedTouches[0].clientY}},c=function(t){t.stopImmediatePropagation(),i.state.dragable=!1},g=function(t){t.stopImmediatePropagation(),i.state.dragable=!1},d=function(t){t.originalEvent.wheelDelta>0||t.originalEvent.detail<0?i.ratio*=1.1:i.ratio*=.9,a()};return i.spinner.show(),i.image.onload=function(){i.spinner.hide(),a(),t(window).bind("mouseup",c),n.bind("mousedown",o),n.bind("mousemove",r),t(window).bind("touchend",g),n.bind("touchstart",s),n.bind("touchmove",u),n.bind("mousewheel DOMMouseScroll",d)},i.image.src=e.imgSrc,n.on("remove",function(){t(window).unbind("mouseup",c)}),i}(e,this)}});
