"use strict";var cropbox=function(e){function t(e,t){for(var n=1;n<arguments.length;n++)for(var a in arguments[n])arguments[n].hasOwnProperty(a)&&(arguments[0][a]=arguments[n][a]);return arguments[0]}var n={scrollToZoom:!0};e=t(n,e);var a=document.querySelector(e.imageBox),o={state:{},ratio:1,options:e,imageBox:a,thumbBox:a.querySelector(e.thumbBox),spinner:a.querySelector(e.spinner),image:new Image,getDataURL:function(){var e=this.thumbBox.clientWidth,t=this.thumbBox.clientHeight,n=document.createElement("canvas"),o=a.style.backgroundPosition.split(" "),i=a.style.backgroundSize.split(" "),r=parseInt(o[0])-a.clientWidth/2+e/2,s=parseInt(o[1])-a.clientHeight/2+t/2,u=parseInt(i[0]),c=parseInt(i[1]),m=parseInt(this.image.height),g=parseInt(this.image.width);n.width=e,n.height=t;var l=n.getContext("2d");l.drawImage(this.image,0,0,g,m,r,s,u,c);var d=n.toDataURL("image/png");return d},getBlob:function(){for(var e=this.getDataURL(),t=e.replace("data:image/png;base64,",""),n=atob(t),a=[],o=0;o<n.length;o++)a.push(n.charCodeAt(o));return new Blob([new Uint8Array(a)],{type:"image/png"})},zoomIn:function(){this.ratio*=1.1,u()},zoomOut:function(){this.ratio*=.9,u()}},i=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n)},r=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener&&e.removeEventListener(t,render)},s=function(e){window.event?e.cancelBubble=!0:e.stopImmediatePropagation()},u=function(){var e=parseInt(o.image.width)*o.ratio,t=parseInt(o.image.height)*o.ratio,n=(a.clientWidth-e)/2,i=(a.clientHeight-t)/2;a.setAttribute("style","background-image: url("+o.image.src+"); background-size: "+e+"px "+t+"px; background-position: "+n+"px "+i+"px; background-repeat: no-repeat")},c=function(e){s(e),o.state.dragable=!0,o.state.mouseX=e.clientX,o.state.mouseY=e.clientY},m=function(e){if(s(e),o.state.dragable){var t=e.clientX-o.state.mouseX,n=e.clientY-o.state.mouseY,i=a.style.backgroundPosition.split(" "),r=t+parseInt(i[0]),u=n+parseInt(i[1]);a.style.backgroundPosition=r+"px "+u+"px",o.state.mouseX=e.clientX,o.state.mouseY=e.clientY}},g=function(e){s(e),o.state.dragable=!1},l=function(e){var t=window.event||e,n=t.detail?-120*t.detail:t.wheelDelta;n>-120?o.ratio*=1.1:o.ratio*=.9,u()};return o.spinner.style.display="block",o.image.onload=function(){if(o.spinner.style.display="none",u(),i(a,"mousedown",c),i(a,"mousemove",m),i(document.body,"mouseup",g),e.scrollToZoom){var t=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";i(a,t,l)}},o.image.src=e.imgSrc,i(a,"DOMNodeRemoved",function(){r(document.body,"DOMNodeRemoved",g)}),o};
