"use strict";var cropbox=function(e){var t=document.querySelector(e.imageBox),n={state:{},ratio:1,options:e,imageBox:t,thumbBox:t.querySelector(e.thumbBox),spinner:t.querySelector(e.spinner),image:new Image,getDataURL:function(){var e=this.thumbBox.clientWidth,n=this.thumbBox.clientHeight,a=document.createElement("canvas"),o=t.style.backgroundPosition.split(" "),i=t.style.backgroundSize.split(" "),s=parseInt(o[0])-t.clientWidth/2+e/2,r=parseInt(o[1])-t.clientHeight/2+n/2,c=parseInt(i[0]),u=parseInt(i[1]),d=parseInt(this.image.height),l=parseInt(this.image.width);return a.width=e,a.height=n,a.getContext("2d").drawImage(this.image,0,0,l,d,s,r,c,u),a.toDataURL("image/png")},getBlob:function(){for(var e=this.getDataURL().replace("data:image/png;base64,",""),t=atob(e),n=[],a=0;a<t.length;a++)n.push(t.charCodeAt(a));return new Blob([new Uint8Array(n)],{type:"image/png"})},zoomIn:function(){this.ratio*=1.1,i()},zoomOut:function(){this.ratio*=.9,i()}},a=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n)},o=function(e){window.event?e.cancelBubble=!0:e.stopImmediatePropagation()},i=function(){var e=parseInt(n.image.width)*n.ratio,a=parseInt(n.image.height)*n.ratio,o=(t.clientWidth-e)/2,i=(t.clientHeight-a)/2;t.setAttribute("style","background-image: url("+n.image.src+"); background-size: "+e+"px "+a+"px; background-position: "+o+"px "+i+"px; background-repeat: no-repeat")},s=function(e){o(e),n.state.dragable=!0,n.state.mouseX=e.clientX,n.state.mouseY=e.clientY},r=function(e){o(e),n.state.dragable=!0,n.state.mouseX=e.changedTouches[0].clientX,n.state.mouseY=e.changedTouches[0].clientY},c=function(e){if(o(e),n.state.dragable){var a=e.clientX-n.state.mouseX,i=e.clientY-n.state.mouseY,s=t.style.backgroundPosition.split(" "),r=a+parseInt(s[0]),c=i+parseInt(s[1]);t.style.backgroundPosition=r+"px "+c+"px",n.state.mouseX=e.clientX,n.state.mouseY=e.clientY}},u=function(e){if(o(e),n.state.dragable){var a=e.changedTouches[0].clientX-n.state.mouseX,i=e.changedTouches[0].clientY-n.state.mouseY,s=t.style.backgroundPosition.split(" "),r=a+parseInt(s[0]),c=i+parseInt(s[1]);t.style.backgroundPosition=r+"px "+c+"px",n.state.mouseX=e.changedTouches[0].clientX,n.state.mouseY=e.changedTouches[0].clientY}},d=function(e){o(e),n.state.dragable=!1},l=function(e){o(e),n.state.dragable=!1},g=function(e){var t=window.event||e,a=t.detail?-120*t.detail:t.wheelDelta;n.ratio*=a>-120?1.1:.9,i()};return n.spinner.style.display="block",n.image.onload=function(){n.spinner.style.display="none",i(),a(document.body,"mouseup",d),a(t,"mousedown",s),a(t,"mousemove",c),a(document.body,"touchend",l),a(t,"touchstart",r),a(t,"touchmove",u);var e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";a(t,e,g)},n.image.src=e.imgSrc,a(t,"DOMNodeRemoved",function(){var e,t,n;e=document.body,t="DOMNodeRemoved",n=d,e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener&&e.removeEventListener(t,render)}),n};
